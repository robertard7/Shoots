<Window x:Class="Shoots.UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:Shoots.UI.Converters"
        Title="{Binding WindowTitle}" Height="640" Width="860">
  <Window.Resources>
    <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
    <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
  </Window.Resources>
  <Grid Margin="24">
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="220" />
      <ColumnDefinition Width="*" />
    </Grid.ColumnDefinitions>
    <StackPanel Grid.Column="0" Margin="0,0,16,0">
      <TextBlock Text="Project Workspace" FontWeight="SemiBold" ToolTip="{Binding WorkspaceIsolationTooltip}" />
      <Button Margin="0,8,0,0" Content="New Project" IsEnabled="False" ToolTip="Project creation is coming later" />
      <TextBlock Margin="0,16,0,0" Text="Recent Projects" FontWeight="SemiBold" />
      <ListBox ItemsSource="{Binding RecentWorkspaces}"
               SelectedItem="{Binding SelectedWorkspace, Mode=TwoWay}"
               DisplayMemberPath="Name"
               Margin="0,8,0,0">
        <ListBox.ContextMenu>
          <ContextMenu DataContext="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource Self}}">
            <MenuItem Header="Remove from list"
                      Command="{Binding RemoveWorkspaceCommand}"
                      CommandParameter="{Binding SelectedWorkspace}" />
            <MenuItem Header="Open folder"
                      Command="{Binding OpenWorkspaceCommand}"
                      CommandParameter="{Binding SelectedWorkspace}" />
          </ContextMenu>
        </ListBox.ContextMenu>
        <ListBox.ItemContainerStyle>
          <Style TargetType="ListBoxItem">
            <Setter Property="Padding" Value="6,4" />
            <Setter Property="Margin" Value="0,2,0,0" />
            <Style.Triggers>
              <Trigger Property="IsSelected" Value="True">
                <Setter Property="FontWeight" Value="SemiBold" />
                <Setter Property="Foreground" Value="#FF2B6CB0" />
              </Trigger>
            </Style.Triggers>
          </Style>
        </ListBox.ItemContainerStyle>
      </ListBox>
      <TextBlock Margin="0,8,0,0"
                 Text="No recent projects yet."
                 Foreground="#FF6B7280"
                 Visibility="{Binding HasNoWorkspaces, Converter={StaticResource BooleanToVisibilityConverter}}" />
      <TextBlock Margin="0,8,0,0"
                 Text="Select a project to preview workspace scripts."
                 Foreground="#FF6B7280"
                 Visibility="{Binding HasNoActiveWorkspace, Converter={StaticResource BooleanToVisibilityConverter}}" />
      <TextBlock Margin="0,16,0,0" Text="{Binding ActiveWorkspaceName}" />
      <GroupBox Margin="0,12,0,0" Header="Tool Tier">
        <StackPanel Margin="8">
          <Border Background="#FFEFF6FF" CornerRadius="4" Padding="6">
            <TextBlock Text="{Binding ActiveToolpackTierLabel}"
                       ToolTip="{Binding ActiveToolpackTierTooltip}" />
          </Border>
          <TextBlock Margin="0,6,0,0"
                     Foreground="#FF6B7280"
                     Text="{Binding SystemTierNote}"
                     TextWrapping="Wrap" />
          <ComboBox Margin="0,6,0,0"
                    ItemsSource="{Binding ToolpackTierOptions}"
                    SelectedItem="{Binding SelectedToolpackTier}"
                    IsEnabled="{Binding CanSelectToolpackTier}" />
          <Button Margin="0,6,0,0"
                  Content="{Binding SystemTierActionLabel}"
                  Command="{Binding ToggleSystemTierCommand}"
                  ToolTip="{Binding ActiveToolpackTierTooltip}"
                  ToolTipService.ShowOnDisabled="True"
                  IsEnabled="{Binding HasActiveWorkspace}" />
        </StackPanel>
      </GroupBox>
      <GroupBox Margin="0,12,0,0" Header="Role">
        <StackPanel Margin="8">
          <ComboBox ItemsSource="{Binding RoleOptions}"
                    SelectedItem="{Binding SelectedRole}"
                    DisplayMemberPath="Name"
                    IsEnabled="{Binding HasActiveWorkspace}" />
          <TextBlock Margin="0,6,0,0"
                     Foreground="#FF6B7280"
                     Text="{Binding SelectedRoleDescription}"
                     TextWrapping="Wrap" />
        </StackPanel>
      </GroupBox>
    </StackPanel>
    <TabControl Grid.Column="1">
      <TabItem Header="Execution">
        <Grid Margin="16">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
          </Grid.RowDefinitions>
          <Border Background="#FFEFF6FF" Padding="12" CornerRadius="4">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
              <TextBlock Text="Execution State:" FontWeight="SemiBold" />
              <TextBlock Text="{Binding StateLabel}" Margin="8,0,0,0" />
              <TextBlock Text="Replay Mode" Margin="16,0,0,0"
                         ToolTip="Replay mode is read-only and trace-backed."
                         Visibility="{Binding IsReplayMode, Converter={StaticResource BooleanToVisibilityConverter}}" />
            </StackPanel>
          </Border>
          <StackPanel Grid.Row="1" Margin="0,16,0,0" Orientation="Horizontal" HorizontalAlignment="Left">
            <Button Width="110"
                    Content="Start"
                    Command="{Binding StartCommand}"
                    ToolTip="{Binding StartDisabledReason}"
                    ToolTipService.ShowOnDisabled="True" />
            <Button Width="110" Margin="8,0,0,0" Content="Cancel" Command="{Binding CancelCommand}" />
            <Button Width="140" Margin="8,0,0,0" Content="Refresh Status" Command="{Binding RefreshStatusCommand}" />
          </StackPanel>
          <TextBlock Grid.Row="2" Margin="0,24,0,0" Text="Shoots UI Shell" FontSize="20" FontWeight="SemiBold" />
        </Grid>
      </TabItem>
      <TabItem Header="AI Help">
        <Grid Margin="16">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
          </Grid.RowDefinitions>
          <Border Background="#FFFDF4D7" CornerRadius="4" Padding="10">
            <TextBlock Text="Informational assistance only." FontWeight="SemiBold" />
          </Border>
          <StackPanel Grid.Row="1" Margin="0,12,0,0">
            <Button Width="160"
                    Content="Refresh AI Help"
                    Command="{Binding RefreshAiHelpCommand}"
                    ToolTip="{Binding AiHelpDisabledReason}"
                    ToolTipService.ShowOnDisabled="True" />
            <GroupBox Header="Context Summary" Margin="0,12,0,0">
              <TextBlock Margin="12" Text="{Binding AiHelpContextSummary}" TextWrapping="Wrap" />
            </GroupBox>
            <GroupBox Header="State Explanation" Margin="0,12,0,0">
              <TextBlock Margin="12" Text="{Binding AiHelpStateExplanation}" TextWrapping="Wrap" />
            </GroupBox>
            <GroupBox Header="Suggested Next Steps" Margin="0,12,0,0">
              <TextBlock Margin="12" Text="{Binding AiHelpNextSteps}" TextWrapping="Wrap" />
            </GroupBox>
            <TextBlock Margin="0,12,0,0"
                       Foreground="#FF6B7280"
                       Text="AI Help is descriptive and does not execute actions."
                       TextWrapping="Wrap" />
          </StackPanel>
        </Grid>
      </TabItem>
      <TabItem Header="Blueprints">
        <Grid Margin="16">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
          </Grid.RowDefinitions>
          <StackPanel>
            <TextBlock Text="Blueprints capture ordered intents and expected artifacts." TextWrapping="Wrap" />
            <TextBlock Margin="0,6,0,0"
                       Foreground="#FF6B7280"
                       Text="{Binding BlueprintStatusNote}"
                       TextWrapping="Wrap" />
          </StackPanel>
          <Grid Grid.Row="1" Margin="0,12,0,0">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*" />
              <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <StackPanel Margin="0,0,12,0">
              <GroupBox Header="Register Blueprint" IsEnabled="{Binding CanManageBlueprints}">
                <StackPanel Margin="12">
                  <TextBlock Text="Name" />
                  <TextBox Margin="0,4,0,0" Text="{Binding NewBlueprintName, UpdateSourceTrigger=PropertyChanged}" />
                  <TextBlock Margin="0,8,0,0" Text="Description" />
                  <TextBox Margin="0,4,0,0" Text="{Binding NewBlueprintDescription}" TextWrapping="Wrap" Height="60" />
                  <TextBlock Margin="0,8,0,0" Text="Intents (one per line)" />
                  <TextBox Margin="0,4,0,0" Text="{Binding NewBlueprintIntents}" AcceptsReturn="True" Height="80" />
                  <TextBlock Margin="0,8,0,0" Text="Expected artifacts (one per line)" />
                  <TextBox Margin="0,4,0,0" Text="{Binding NewBlueprintArtifacts}" AcceptsReturn="True" Height="80" />
                  <Button Margin="0,12,0,0"
                          Content="Add Blueprint"
                          Command="{Binding AddBlueprintCommand}"
                          IsEnabled="{Binding CanManageBlueprints}" />
                </StackPanel>
              </GroupBox>
            </StackPanel>
            <GroupBox Grid.Column="1" Header="Registered Blueprints">
              <ListBox Margin="8" ItemsSource="{Binding Blueprints}">
                <ListBox.ItemTemplate>
                  <DataTemplate>
                    <StackPanel Margin="0,4,0,4">
                      <TextBlock Text="{Binding Name}" FontWeight="SemiBold" />
                      <TextBlock Text="{Binding Description}" TextWrapping="Wrap" />
                      <TextBlock Foreground="#FF6B7280"
                                 Text="{Binding CreatedUtc}"
                                 TextWrapping="Wrap" />
                    </StackPanel>
                  </DataTemplate>
                </ListBox.ItemTemplate>
              </ListBox>
            </GroupBox>
          </Grid>
        </Grid>
      </TabItem>
      <TabItem Header="Execution Environment">
        <Grid Margin="16">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
          </Grid.RowDefinitions>
          <StackPanel>
            <TextBlock Text="Execution environments are user-provided rootfs entries." TextWrapping="Wrap" />
            <TextBlock Margin="0,6,0,0"
                       Foreground="#FF6B7280"
                       Text="{Binding RootFsNotice}"
                       TextWrapping="Wrap" />
          </StackPanel>
          <Grid Grid.Row="1" Margin="0,12,0,0">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="240" />
              <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <GroupBox Header="Rootfs Catalog">
              <ListBox Margin="8"
                       ItemsSource="{Binding RootFsCatalog}"
                       SelectedItem="{Binding SelectedRootFs}"
                       DisplayMemberPath="DisplayName" />
            </GroupBox>
            <GroupBox Grid.Column="1" Margin="12,0,0,0" Header="Selected Rootfs">
              <StackPanel Margin="12">
                <TextBlock Text="{Binding ActiveRootFsLabel}" FontWeight="SemiBold" />
                <TextBlock Margin="0,6,0,0" Text="{Binding ActiveRootFsSource}" TextWrapping="Wrap" />
                <TextBlock Margin="0,10,0,0" Text="Execution distro source override (URL or local path)" />
                <TextBox Margin="0,4,0,0" Text="{Binding RootFsSourceOverride, UpdateSourceTrigger=PropertyChanged}" />
                <TextBlock Margin="0,6,0,0" Foreground="#FF6B7280" Text="{Binding RootFsFallbackNotice}" TextWrapping="Wrap" />
                <TextBlock Margin="0,6,0,0" Text="{Binding ActiveRootFsLicense}" TextWrapping="Wrap" />
                <TextBlock Margin="0,6,0,0" Text="{Binding ActiveRootFsNotes}" TextWrapping="Wrap" />
              </StackPanel>
            </GroupBox>
          </Grid>
        </Grid>
      </TabItem>
      <TabItem Header="Environment">
        <Grid Margin="16">
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
          </Grid.RowDefinitions>
          <StackPanel>
            <TextBlock Text="Environment profiles prepare the local sandbox only. This does not affect execution logic." TextWrapping="Wrap" />
            <TextBlock Margin="0,8,0,0" Foreground="DarkRed" Text="{Binding EnvironmentErrorMessage}" TextWrapping="Wrap" />
            <TextBlock Margin="0,4,0,0" Foreground="DarkGreen" Text="{Binding EnvironmentInfoMessage}" TextWrapping="Wrap" />
          </StackPanel>
          <GroupBox Grid.Row="1" Margin="0,12,0,0" Header="Profile">
            <StackPanel Margin="12">
              <ComboBox ItemsSource="{Binding Profiles}" SelectedItem="{Binding SelectedProfile}" DisplayMemberPath="Name" />
              <TextBlock Margin="0,8,0,0" Text="{Binding SelectedProfileDescription}" TextWrapping="Wrap" />
              <ItemsControl Margin="0,8,0,0" ItemsSource="{Binding EnvironmentCapabilities}">
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <TextBlock Text="{Binding}" />
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
            </StackPanel>
          </GroupBox>
          <StackPanel Grid.Row="2" Margin="0,12,0,0" Orientation="Horizontal">
            <Button Width="160"
                    Content="Apply Environment"
                    Command="{Binding ApplyEnvironmentCommand}"
                    ToolTip="{Binding ApplyEnvironmentDisabledReason}"
                    ToolTipService.ShowOnDisabled="True" />
            <TextBlock Margin="12,0,0,0" VerticalAlignment="Center" Text="{Binding EnvironmentAppliedProfileName}" />
          </StackPanel>
          <GroupBox Grid.Row="3" Margin="0,12,0,0" Header="Last Applied">
            <StackPanel Margin="12">
              <TextBlock Text="{Binding EnvironmentAppliedAtUtc}" />
              <ItemsControl Margin="0,8,0,0" ItemsSource="{Binding EnvironmentAppliedCapabilities}">
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <TextBlock Text="{Binding}" />
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
              <ItemsControl Margin="0,8,0,0" ItemsSource="{Binding EnvironmentCreatedPaths}">
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <TextBlock Text="{Binding}" />
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
              <TextBlock Margin="0,8,0,0" Text="Restart recommended to pick up capability changes."
                         Visibility="{Binding RestartRequired, Converter={StaticResource BooleanToVisibilityConverter}}" />
            </StackPanel>
          </GroupBox>
          <StackPanel Grid.Row="4" Margin="0,12,0,0">
            <Border Background="#FFFDECC8"
                    CornerRadius="4"
                    Margin="0,0,0,8"
                    Padding="8"
                    Visibility="{Binding ScriptPreview, Converter={StaticResource NullToVisibilityConverter}}">
              <TextBlock Text="Preview only until applied." FontWeight="SemiBold" />
            </Border>
            <GroupBox Header="Script Preview" Margin="0,0,0,12" Visibility="{Binding ScriptPreview, Converter={StaticResource NullToVisibilityConverter}}">
              <StackPanel Margin="12">
                <TextBlock Text="{Binding ScriptSearchPath}" TextWrapping="Wrap" />
                <TextBlock Text="{Binding ScriptPreview.Name}" FontWeight="SemiBold" />
                <TextBlock Margin="0,4,0,0" Text="{Binding ScriptPreview.Description}" TextWrapping="Wrap" />
                <TextBlock Margin="0,6,0,0"
                           Text="{Binding ScriptUnsupportedCapabilitiesMessage}"
                           Foreground="DarkRed"
                           TextWrapping="Wrap"
                           Visibility="{Binding ScriptUnsupportedCapabilitiesMessage, Converter={StaticResource NullToVisibilityConverter}}" />
                <GroupBox Margin="0,8,0,0" Header="Validation Summary">
                  <StackPanel Margin="8">
                    <TextBlock Text="{Binding ScriptFolderCountLabel}" />
                    <ItemsControl Margin="0,6,0,0" ItemsSource="{Binding ScriptCapabilities}">
                      <ItemsControl.ItemTemplate>
                        <DataTemplate>
                          <TextBlock Text="{Binding}" />
                        </DataTemplate>
                      </ItemsControl.ItemTemplate>
                    </ItemsControl>
                  </StackPanel>
                </GroupBox>
                <ItemsControl Margin="0,8,0,0" ItemsSource="{Binding ScriptSteps}">
                  <ItemsControl.ItemTemplate>
                    <DataTemplate>
                      <TextBlock Text="{Binding}" />
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>
                <TextBlock Margin="0,8,0,0"
                           Foreground="#FF6B7280"
                           Text="Scripts are declarative previews. They do not install tools or execute commands."
                           TextWrapping="Wrap" />
                <Button Width="160"
                        Margin="0,8,0,0"
                        Content="Apply Script"
                        Command="{Binding ApplyScriptCommand}"
                        ToolTip="{Binding ApplyScriptDisabledReason}"
                        ToolTipService.ShowOnDisabled="True" />
              </StackPanel>
            </GroupBox>
            <GroupBox Header="Source Control" Visibility="{Binding HasSourceControl, Converter={StaticResource BooleanToVisibilityConverter}}">
              <TextBlock Margin="12" Text="Source control integration is optional and enabled only by the environment profile." TextWrapping="Wrap" />
            </GroupBox>
            <GroupBox Margin="0,12,0,0" Header="Artifact Export" Visibility="{Binding HasArtifactExport, Converter={StaticResource BooleanToVisibilityConverter}}">
              <StackPanel Margin="12">
                <TextBlock Text="Artifact export UI is enabled by the environment profile." TextWrapping="Wrap" />
                <Button Width="160" Margin="0,8,0,0" Content="Export Artifacts" />
              </StackPanel>
            </GroupBox>
          </StackPanel>
        </Grid>
      </TabItem>
      <TabItem Header="Database" Visibility="{Binding HasDatabase, Converter={StaticResource BooleanToVisibilityConverter}}">
        <Grid Margin="16">
          <StackPanel>
            <TextBlock Text="Database intent is optional and never needed for Shoots execution." TextWrapping="Wrap" />
            <GroupBox Margin="0,12,0,0" Header="Intent">
              <StackPanel Margin="12">
                <ListBox ItemsSource="{Binding DatabaseIntents}"
                         SelectedItem="{Binding SelectedDatabaseIntent}"
                         BorderThickness="0"
                         IsEnabled="{Binding HasActiveWorkspace}">
                  <ListBox.ItemTemplate>
                    <DataTemplate>
                      <StackPanel Margin="0,0,0,8">
                        <RadioButton Content="{Binding Name}"
                                     IsChecked="{Binding RelativeSource={RelativeSource AncestorType=ListBoxItem}, Path=IsSelected}" />
                        <TextBlock Margin="24,2,0,0" Text="{Binding Description}" TextWrapping="Wrap" />
                      </StackPanel>
                    </DataTemplate>
                  </ListBox.ItemTemplate>
                </ListBox>
                <TextBlock Margin="0,4,0,0"
                           Foreground="#FF6B7280"
                           Text="Database support is not implemented by design." />
              </StackPanel>
            </GroupBox>
          </StackPanel>
        </Grid>
      </TabItem>
    </TabControl>
  </Grid>
</Window>
